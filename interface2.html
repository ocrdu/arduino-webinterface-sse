<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Interface</title>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAZwI1BmQHML9SABmBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHYtSQ8AAAAAAAAAAGUAMrFnADT/ZAAwgQAAAAAAAAAAAAAAAHAlQBJIAAsbTwAUHwAAAAAAAAAASQAMZnAnQIFwGUHWbAo8/2wKPP9mADP/ZgAz/2wKPP9sCjz/bAo8/2wKPP9sCjz/bAo8/2wKPP8AAAAAAAAAAFUAHD1TABqHZwI0G2cANWtmADP/ZgAz/2UAMv9tCTz0ayA5sV4AKChgACwhbgk+FXIlQgMAAAAAAAAAAAAAAABkADAxZBExEIQ2XDdoBDf1ZQAy/2YAM/9lADL/bgw++3QkRhEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFcCIARgBizAZwA1/2YAM/9mADP/ZAAx/3QZRriFM14GAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoBzYIZQAy92YAM/9mADP/ZgAz/2YAM/9nATR4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAn1+AQGkGN/hlADH/ZgAz/2YAM/9mADP/ZQAyggAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApmmICIc1XsBiAS//ZgAz/2YAM/9lADL/aQU3/pFGbHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG8cQBBqDDj4ZQAy/2YAM/9mADP/ZgAz/2YDNPmBMFYXAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABOABUPWwAl8GgANf9mADP/ZgAz/2gANv9ZACHARQAHBgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfjRTD3EZQvBkADH/ZgAz/2YAM/9mADPxZQAxPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAQQQ9rBzrwZQAy/2YAM/9mADP/ZgAziAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABlADEPZQAy8GQAMP9lADL/ZQAy/mQAMHcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaAA1D2kDNvl0GEbybQo88GwKPPp1GUcYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFcAHxhsCjz/iTliFm8WPyVsCjz/hzZfCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/z8vvf4/ob3gAI697B/GvPg/hDvwP9g78H8FvfA/i73gfw+94H9tPOB/pD3g/9s94P/KPeH/dD3h/2e67f8kvQ==">
    <style>
body {
  background-color: #E5E5FF;
}
p, label {
  font-family: Arial, sans-serif;
}
.connection svg {
  vertical-align: bottom;
}
label {
  font-weight: bold;
  font-size: 1.6vw;
}
.controls {
  height: 200px;
  width: 100%;
  display: flex;
  align-items: center;
}
input[type=range] {
  -webkit-appearance: none;
  width: 75%;
  height: 20%;
  margin: 20px 10px 20px 10px;
  outline: none;
}
input[type=range]::-webkit-slider-runnable-track {
  -webkit-appearance: none;
  width: 100%;
  height: 8px;
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  background: #3071a9;
  border-radius: 2px;
  border: 1px solid #010101;
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  border: 1px solid #000000;
  height: 34px;
  width: 13px;
  border-radius: 3px;
  background: rgba(255, 255, 255, 1);
  margin-top: -13px;
}
input[type=range]::-moz-range-track {
  width: 100%;
  height: 8px;
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  background: #3071a9;
  border-radius: 2px;
  border: 1px solid #010101;
}
input[type=range]::-moz-range-thumb {
  box-shadow: 1px 1px 1px #000000, 0px 0px 1px #0d0d0d;
  border: 1px solid #000000;
  height: 34px;
  width: 13px;
  border-radius: 3px;
  background: rgba(255, 255, 255, 1);
}
.switches {
  background-color: white;
  width: 15%; height: 70%;
  border: solid 1px; border-radius: 5px; margin-left: -1px; padding: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.onoffswitch {
  position: relative; 
  width: 70%;
}
.onoffswitch-checkbox {
  display: none;
}
.onoffswitch-label {
  width: 100%; height: 6vw;
  display: block; overflow: hidden; 
  cursor: pointer;
  border: 2px solid #000000; border-radius: 15px; box-shadow: 1px 1px;
}
.onoffswitch-inner {
  display: block; width: 200%; margin-left: -100%;
}
.onoffswitch-inner:before, .onoffswitch-inner:after {
  display: block; float: left; 
  width: 50%; height: 6vw; 
  padding: 0; 
  line-height: 6vw;
  font-size: 1.6vw; color: white; font-family: Trebuchet, Arial, sans-serif; font-weight: bold;
  box-sizing: border-box;
}
.onoffswitch-inner:before {
  content: "ON";
  padding-left: 1.2vw;
  background-color: #3071A9; color: #FFFFFF;
}
.onoffswitch-inner:after {
  content: "OFF";
  padding-right: 0.8vw;
  background-color: #3071A9; color: #FFFFFF;
  text-align: right;
}
.onoffswitch-switch {
  display: block; width: 4vw; height: 4vw; margin-top: 1vw; margin-left:0.6vw; margin-right:0.6vw;
  background: #FF0000;
  position: absolute; top: 0; bottom: 0;
  border: 2px solid #000000; border-radius: 30px;
  transition: all 0.5s ease-in-out; 
}
.onoffswitch-checkbox:checked + .onoffswitch-label .onoffswitch-inner {
  margin-left: 0;
}
.onoffswitch-checkbox:checked + .onoffswitch-label .onoffswitch-switch {
  right: 0; 
  background-color: #00FF00; 
}
.sliders {
  background-color: white;
  width: 40%; height: 70%;
  border: solid 1px; border-radius: 5px;
  margin-left: -1px;
  padding: 5px;
  align-items: center;
  justify-content: center;
}
.slider {
  width: 100%; height: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.slidercontrol {
  width: 85%;
}
.sliderlabel {
  width: 15%;
}
    </style>
  </head>
  <body>
    <div id="connection" class="connection" style="height:40px;"></div>
    <hr>
    <div id="controls" class="controls">
      <div id="switches" class="switches">
        <div id="onoffswitch" class="onoffswitch">
          <input type="checkbox" id="switch" name="switch" class="onoffswitch-checkbox" onChange="talk(name, checked)">
          <label for="switch" id="onoffswitch-label" class="onoffswitch-label">
            <div class="onoffswitch-inner"></div>
            <div class="onoffswitch-switch"></div>
          </label>
        </div>
      </div>
      <div id="sliders" class="sliders">
        <div id="slider1" class="slider">
          <input type="range" id="volume" name="volume" class="slidercontrol" min="0" max="100" onChange="talk(name, value)">
          <label for="volume" class="sliderlabel">Volume</label>
        </div>
        <div id="slider2" class="slider">
          <input type="range" id="cowbell" name="cowbell" class="slidercontrol" min="0" max="100" onChange="talk(name, value)">
          <label for="cowbell" class="sliderlabel">Cowbell</label>
        </div>
      </div>
    </div>
    <hr>
    <p>Response from the Other Side:</p>
    <textarea name="servermessages" id="servermessages" class="servermessages" rows="10" cols="73" style="width:50%; height:20%;" readonly></textarea>
    <br><br><hr>
    <script>
    
var server = "http://" + window.location.hostname;
const port = window.location.port;
if (port != "") {
  server += ":" + port;
}
server += "/";

document.getElementById("switch").checked = false;
document.getElementById("volume").value = 0;
document.getElementById("cowbell").value = 0;
document.getElementById("switch").disabled = true;
document.getElementById("volume").disabled = true;
document.getElementById("cowbell").disabled = true;
document.getElementById("switches").style.opacity = "0.3";
document.getElementById("sliders").style.opacity = "0.3";
document.getElementById("onoffswitch-label").style.cursor = "not-allowed";
document.getElementById("volume").style.cursor = "not-allowed";
document.getElementById("cowbell").style.cursor = "not-allowed";

document.getElementById("connection").innerHTML = '<p style="color:#FFA500;"><svg fill="none" version="1.1" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12 17.435c-0.9281 0-1.68 0.7548-1.68 1.6811 0 0.9262 0.7519 1.6776 1.68 1.6776 0.9274 0 1.68-0.7514 1.68-1.6776 0-0.9263-0.7526-1.6811-1.68-1.6811zm11.744-7.9502c-2.9324-3.4845-7.2128-5.4847-11.743-5.4847-4.5306 0-8.8119 2.0002-11.744 5.4847-0.38904 0.46375-0.32785 1.1548 0.13607 1.5437 0.20274 0.1716 0.45297 0.2565 0.70228 0.2565 0.31416 0 0.62466-0.1315 0.83836-0.388 2.5151-2.9924 6.1827-4.7078 10.068-4.7078 3.8813 0 7.5516 1.7153 10.067 4.7042 0.2137 0.2601 0.5242 0.3916 0.8384 0.3916 0.2493 0 0.4995-0.0849 0.7032-0.2565 0.463-0.3889 0.5242-1.08 0.1351-1.5437zm-11.743-1.1019c-3.2356 0-6.2932 1.4259-8.3872 3.9154-0.38904 0.4638-0.33151 1.1548 0.13242 1.5437 0.20639 0.1716 0.45662 0.2565 0.70594 0.2565 0.3105 0 0.62101-0.1314 0.83836-0.3879 1.6767-1.9938 4.1206-3.1386 6.7105-3.1386 2.59 0 5.0329 1.1448 6.7096 3.1386 0.2183 0.2565 0.5279 0.3879 0.8384 0.3879 0.2502 0 0.4995-0.0812 0.7068-0.2565 0.464-0.3889 0.5242-1.0799 0.1315-1.5437-2.094-2.4894-5.1507-3.9154-8.3863-3.9154zm0 4.3828c-1.9443 0-3.7781 0.8554-5.0338 2.3498-0.38904 0.4601-0.32785 1.1512 0.13516 1.5401 0.20366 0.1752 0.45297 0.2574 0.7032 0.2574 0.31416 0 0.62375-0.1324 0.84201-0.3889 0.83471-0.9987 2.0584-1.5693 3.3534-1.5693s2.5178 0.5706 3.3525 1.5693c0.2183 0.2565 0.5288 0.3889 0.842 0.3889 0.2503 0 0.4996-0.0822 0.7032-0.2574 0.464-0.3889 0.5242-1.08 0.1352-1.5401-1.2557-1.4944-3.0886-2.3498-5.0329-2.3498z" clip-rule="evenodd" fill="#FFA500" fill-rule="evenodd"><animate attributeName="fill-opacity" attributeType="XML" dur="0.2s" repeatCount="indefinite" values="1;0"/></path></svg> Connecting ...</p>';

const evtSource = new EventSource(server);

evtSource.onopen = function(m) {
  document.getElementById("connection").innerHTML = '<p style="color:#00A45B;"><svg fill="none" version="1.1" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12 17.435c-0.9281 0-1.68 0.7548-1.68 1.6811 0 0.9262 0.7519 1.6776 1.68 1.6776 0.9274 0 1.68-0.7514 1.68-1.6776 0-0.9263-0.7526-1.6811-1.68-1.6811zm11.744-7.9502c-2.9324-3.4845-7.2128-5.4847-11.743-5.4847-4.5306 0-8.8119 2.0002-11.744 5.4847-0.38904 0.46375-0.32785 1.1548 0.13607 1.5437 0.20274 0.1716 0.45297 0.2565 0.70228 0.2565 0.31416 0 0.62466-0.1315 0.83836-0.388 2.5151-2.9924 6.1827-4.7078 10.068-4.7078 3.8813 0 7.5516 1.7153 10.067 4.7042 0.2137 0.2601 0.5242 0.3916 0.8384 0.3916 0.2493 0 0.4995-0.0849 0.7032-0.2565 0.463-0.3889 0.5242-1.08 0.1351-1.5437zm-11.743-1.1019c-3.2356 0-6.2932 1.4259-8.3872 3.9154-0.38904 0.4638-0.33151 1.1548 0.13242 1.5437 0.20639 0.1716 0.45662 0.2565 0.70594 0.2565 0.3105 0 0.62101-0.1314 0.83836-0.3879 1.6767-1.9938 4.1206-3.1386 6.7105-3.1386 2.59 0 5.0329 1.1448 6.7096 3.1386 0.2183 0.2565 0.5279 0.3879 0.8384 0.3879 0.2502 0 0.4995-0.0812 0.7068-0.2565 0.464-0.3889 0.5242-1.0799 0.1315-1.5437-2.094-2.4894-5.1507-3.9154-8.3863-3.9154zm0 4.3828c-1.9443 0-3.7781 0.8554-5.0338 2.3498-0.38904 0.4601-0.32785 1.1512 0.13516 1.5401 0.20366 0.1752 0.45297 0.2574 0.7032 0.2574 0.31416 0 0.62375-0.1324 0.84201-0.3889 0.83471-0.9987 2.0584-1.5693 3.3534-1.5693s2.5178 0.5706 3.3525 1.5693c0.2183 0.2565 0.5288 0.3889 0.842 0.3889 0.2503 0 0.4996-0.0822 0.7032-0.2574 0.464-0.3889 0.5242-1.08 0.1352-1.5401-1.2557-1.4944-3.0886-2.3498-5.0329-2.3498z" clip-rule="evenodd" fill="#00A45B" fill-rule="evenodd"/></svg> Connected</p>';
  document.getElementById("switch").disabled = false;
  document.getElementById("volume").disabled = false;
  document.getElementById("cowbell").disabled = false;
  document.getElementById("switches").style.opacity = "1";
  document.getElementById("sliders").style.opacity = "1";
  document.getElementById("onoffswitch-label").style.cursor = "pointer";
  document.getElementById("volume").style.cursor = "pointer";
  document.getElementById("cowbell").style.cursor = "pointer";
}

evtSource.onerror = function(m) {
    document.getElementById("connection").innerHTML = '<p style="color:#F75535;"><svg fill="none" version="1.1" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12 17.435c-0.9281 0-1.68 0.7548-1.68 1.6811 0 0.9262 0.7519 1.6776 1.68 1.6776 0.9274 0 1.68-0.7514 1.68-1.6776 0-0.9263-0.7526-1.6811-1.68-1.6811zm11.744-7.9502c-2.9324-3.4845-7.2128-5.4847-11.743-5.4847-4.5306 0-8.8119 2.0002-11.744 5.4847-0.38904 0.46375-0.32785 1.1548 0.13607 1.5437 0.20274 0.1716 0.45297 0.2565 0.70228 0.2565 0.31416 0 0.62466-0.1315 0.83836-0.388 2.5151-2.9924 6.1827-4.7078 10.068-4.7078 3.8813 0 7.5516 1.7153 10.067 4.7042 0.2137 0.2601 0.5242 0.3916 0.8384 0.3916 0.2493 0 0.4995-0.0849 0.7032-0.2565 0.463-0.3889 0.5242-1.08 0.1351-1.5437zm-11.743-1.1019c-3.2356 0-6.2932 1.4259-8.3872 3.9154-0.38904 0.4638-0.33151 1.1548 0.13242 1.5437 0.20639 0.1716 0.45662 0.2565 0.70594 0.2565 0.3105 0 0.62101-0.1314 0.83836-0.3879 1.6767-1.9938 4.1206-3.1386 6.7105-3.1386 2.59 0 5.0329 1.1448 6.7096 3.1386 0.2183 0.2565 0.5279 0.3879 0.8384 0.3879 0.2502 0 0.4995-0.0812 0.7068-0.2565 0.464-0.3889 0.5242-1.0799 0.1315-1.5437-2.094-2.4894-5.1507-3.9154-8.3863-3.9154zm0 4.3828c-1.9443 0-3.7781 0.8554-5.0338 2.3498-0.38904 0.4601-0.32785 1.1512 0.13516 1.5401 0.20366 0.1752 0.45297 0.2574 0.7032 0.2574 0.31416 0 0.62375-0.1324 0.84201-0.3889 0.83471-0.9987 2.0584-1.5693 3.3534-1.5693s2.5178 0.5706 3.3525 1.5693c0.2183 0.2565 0.5288 0.3889 0.842 0.3889 0.2503 0 0.4996-0.0822 0.7032-0.2574 0.464-0.3889 0.5242-1.08 0.1352-1.5401-1.2557-1.4944-3.0886-2.3498-5.0329-2.3498z" clip-rule="evenodd" fill="#F75535" fill-rule="evenodd"/></svg> Disconnected</p>';
    evtSource.close();
    document.getElementById("switch").disabled = true;
    document.getElementById("volume").disabled = true;
    document.getElementById("cowbell").disabled = true;
    document.getElementById("switches").style.opacity = "0.3";
    document.getElementById("sliders").style.opacity = "0.3";
    document.getElementById("onoffswitch-label").style.cursor = "not-allowed";
    document.getElementById("volume").style.cursor = "not-allowed";
    document.getElementById("cowbell").style.cursor = "not-allowed";
  }

evtSource.addEventListener("sw", function(m) {
  if (m.data == "true") {
    document.getElementById("switch").checked = true;
  } else {
    document.getElementById("switch").checked = false;
  }
  document.getElementById("switch").onchange();
});

evtSource.addEventListener("volume", function(m) {
  document.getElementById("volume").value = m.data;
  talk(document.getElementById("volume").name, document.getElementById("volume").value);
});

evtSource.addEventListener("cowbell", function(m) {
  document.getElementById("cowbell").value = m.data;
  talk(document.getElementById("cowbell").name, document.getElementById("cowbell").value);
});

evtSource.onmessage = function(m) {
  document.getElementById("servermessages").innerHTML += m.data + "\n";
  document.getElementById("servermessages").scrollTop = document.getElementById("servermessages").scrollHeight;
}

function talk(name, value) {
  var xhr = new XMLHttpRequest();
  xhr.open("HEAD", server + "?" + name + "=" + value, false);
  try {
    xhr.send(null);
  } catch (e) {
    evtSource.onerror(e);
  }
}

window.addEventListener("beforeunload", closeEventSource, false);
function closeEventSource() {
  evtSource.close();
}

window.addEventListener("unload", closeConnections, false);
function closeConnections() {
  navigator.sendBeacon(server, "");
}
    </script>
  </body>
</html>